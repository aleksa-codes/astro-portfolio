---
import Layout from '@/layouts/layout.astro';
import Breadcrumb from '@/components/breadcrumb.astro';
import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';
import Button from '@/components/ui/button.astro';
import Avatar from '@/assets/avatar.png';
import WinterAvatar from '@/assets/avatar-santa.png';
import HalloweenAvatar from '@/assets/avatar-halloween.png';
import SummerAvatar from '@/assets/avatar-summer.png';
---

<Layout
  title='Contact'
  description='Get in touch for collaboration opportunities, project inquiries, or discussions about web development and software engineering solutions.'
>
  <div class='container space-y-6'>
    <Breadcrumb />

    <header class='space-y-6'>
      <h1 class='text-4xl font-extrabold tracking-tight lg:text-5xl'>Contact</h1>

      <div class='flex flex-col items-center justify-center gap-4 md:flex-row md:justify-start md:gap-8'>
        <div class='size-44 overflow-hidden rounded-full'>
          <Image id='avatar' src={Avatar} alt='Cartoon avatar of Aleksa' loading='eager' class='hidden' />
          <Image id='winter-avatar' src={WinterAvatar} alt='Cartoon avatar of Aleksa' loading='eager' class='hidden' />
          <Image
            id='halloween-avatar'
            src={HalloweenAvatar}
            alt='Cartoon avatar of Aleksa'
            loading='eager'
            class='hidden'
          />
          <Image id='summer-avatar' src={SummerAvatar} alt='Cartoon avatar of Aleksa' loading='eager' class='hidden' />
        </div>
        <div class='space-y-4 text-center md:text-left'>
          <p class='max-w-xl text-lg leading-relaxed'>
            Feel free to reach out using the form below. I am always interested in new <span class='highlight'
              >ideas and opportunities!</span
            >
          </p>
          <nav class='flex items-center justify-center gap-2 md:justify-start' aria-label='Alternative contact methods'>
            <Button href='mailto:hello@aleksa.codes' variant='outline'>
              <Icon name='lucide:mail' aria-hidden='true' />
              <span>Email</span>
            </Button>
            <Button
              href='https://discordapp.com/users/1078249969775038514'
              variant='outline'
              target='_blank'
              rel='noopener noreferrer'
            >
              <Icon name='simple-icons:discord' aria-hidden='true' />
              <span>Discord</span>
            </Button>
          </nav>
        </div>
      </div>
    </header>

    <section id='form-content' aria-labelledby='contact-form-heading'>
      <h2 id='contact-form-heading' class='sr-only'>Contact Form</h2>
      <form
        id='contact-form'
        data-netlify='true'
        data-netlify-recaptcha='true'
        netlify-honeypot='bot-field'
        name='contact'
        method='POST'
        class='border-base-300 bg-base-200 rounded-lg border p-6 shadow-xs'
        aria-describedby='form-description'
      >
        <p id='form-description' class='sr-only'>
          Fill out this form to send me a message. All fields marked with an asterisk (*) are required.
        </p>

        <div class='space-y-4'>
          <div class='hidden'>
            <label>Don't fill this out if you're human: <input name='bot-field' tabindex='-1' /></label>
          </div>
          <input type='hidden' name='form-name' value='contact' />
          <input
            type='hidden'
            name='subject'
            value='%{siteName}: New Inquiry from %{formName} form (id: %{submissionId})'
          />

          <fieldset class='space-y-4'>
            <legend class='sr-only'>Your Contact Information</legend>
            <div class='grid grid-cols-1 gap-4 md:grid-cols-2'>
              <div class='w-full'>
                <label for='name' class='text-base-content block text-sm font-medium'>
                  Name <span class='text-error' aria-hidden='true'>*</span>
                </label>
                <input
                  type='text'
                  id='name'
                  name='name'
                  placeholder='e.g. Bon Jovi'
                  required
                  aria-required='true'
                  class='border-base-300 bg-base-100 text-base-content placeholder:text-base-content/50 focus-visible:ring-secondary mt-2 w-full rounded-md border px-3 py-2 ring-offset-2 focus-visible:ring-2 focus-visible:outline-hidden'
                />
              </div>

              <div class='w-full'>
                <label for='email' class='text-base-content block text-sm font-medium'>
                  Email <span class='text-error' aria-hidden='true'>*</span>
                </label>
                <input
                  type='email'
                  id='email'
                  name='email'
                  placeholder='e.g. bon.jovi@gmail.com'
                  required
                  aria-required='true'
                  class='border-base-300 bg-base-100 text-base-content placeholder:text-base-content/50 focus-visible:ring-secondary mt-2 w-full rounded-md border px-3 py-2 ring-offset-2 focus-visible:ring-2 focus-visible:outline-hidden'
                />
              </div>
            </div>

            <div class='w-full'>
              <label for='subject' class='text-base-content block text-sm font-medium'>
                Subject <span class='text-error' aria-hidden='true'>*</span>
              </label>
              <input
                type='text'
                id='subject'
                name='subject'
                placeholder="e.g. Let's Connect!"
                required
                aria-required='true'
                class='border-base-300 bg-base-100 text-base-content placeholder:text-base-content/50 focus-visible:ring-secondary mt-2 w-full rounded-md border px-3 py-2 ring-offset-2 focus-visible:ring-2 focus-visible:outline-hidden'
              />
            </div>

            <div class='w-full'>
              <label for='message' class='text-base-content block text-sm font-medium'>
                Message <span class='text-error' aria-hidden='true'>*</span>
              </label>
              <textarea
                id='message'
                name='message'
                rows='6'
                placeholder='Your Message'
                required
                aria-required='true'
                class='border-base-300 bg-base-100 text-base-content placeholder:text-base-content/50 focus-visible:ring-secondary mt-2 w-full rounded-md border px-3 py-2 ring-offset-2 focus-visible:ring-2 focus-visible:outline-hidden'
              ></textarea>
            </div>
          </fieldset>

          <div class='flex flex-col items-center justify-between gap-4 sm:flex-row'>
            <div data-netlify-recaptcha='true'></div>
            <div class='flex justify-end gap-4'>
              <Button type='reset' variant='ghost'>
                <Icon name='lucide:eraser' class='size-4' aria-hidden='true' />
                <span>Clear</span>
              </Button>
              <Button type='submit' variant='secondary'>
                <Icon name='lucide:send' class='size-4' aria-hidden='true' />
                <span>Send</span>
              </Button>
            </div>
          </div>
        </div>
      </form>
    </section>

    <section id='success-message' class='hidden' aria-labelledby='success-heading' role='alert'>
      <div class='border-base-300 bg-base-200 rounded-lg border p-8 text-center shadow-xs'>
        <div class='bg-success/10 mx-auto flex size-12 items-center justify-center rounded-full'>
          <Icon name='lucide:check' class='text-success size-6' aria-hidden='true' />
        </div>

        <div class='mt-6 space-y-4'>
          <h2 id='success-heading' class='text-base-content text-2xl font-bold'>Thanks for getting in touch!</h2>
          <p class='text-base-content/80'>I'll get back to you as soon as possible.</p>
        </div>

        <Button variant='secondary' id='send-another' class='mt-6'>
          <Icon name='lucide:mail' class='size-4' aria-hidden='true' />
          <span>Send Another Message</span>
        </Button>
      </div>
    </section>
  </div>
</Layout>

<script>
  // Seasonal avatar logic
  const avatar = document.getElementById('avatar');
  const winterAvatar = document.getElementById('winter-avatar');
  const halloweenAvatar = document.getElementById('halloween-avatar');
  const summerAvatar = document.getElementById('summer-avatar');
  const currentMonth = new Date().getMonth();

  if (currentMonth === 9) {
    // October - Halloween
    halloweenAvatar?.classList.remove('hidden');
  } else if ([5, 6, 7].includes(currentMonth)) {
    // June, July, August - Summer
    summerAvatar?.classList.remove('hidden');
  } else if ([11, 0, 1].includes(currentMonth)) {
    // December, January, February - Winter
    winterAvatar?.classList.remove('hidden');
  } else {
    avatar?.classList.remove('hidden');
  }

  const form = document.querySelector('#contact-form') as HTMLFormElement;
  const formContent = document.querySelector('#form-content');
  const successMessage = document.querySelector('#success-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Get reCAPTCHA response and validate
    const recaptchaResponse = (window as any).grecaptcha.getResponse();
    if (!recaptchaResponse) {
      alert('Please complete the reCAPTCHA verification.');
      return;
    }

    const formData = new FormData(e.target as HTMLFormElement);

    try {
      const response = await fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(formData as any).toString(),
      });

      if (response.ok) {
        formContent?.classList.add('hidden');
        successMessage?.classList.remove('hidden');
        form.reset();
        // Reset reCAPTCHA
        (window as any).grecaptcha.reset();
      }
    } catch (error) {
      console.error('Error:', error);
    }
  });

  // Handle "Send Another Message" button
  document.querySelector('#send-another')?.addEventListener('click', () => {
    successMessage?.classList.add('hidden');
    formContent?.classList.remove('hidden');
  });
</script>
